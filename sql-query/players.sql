-- create database

CREATE DATABASE IF NOT EXISTS FOOTBALL;
USE FOOTBALL;

-- create tables

DROP TABLE IF EXISTS GOALS;
DROP TABLE IF EXISTS PLAYERS;

CREATE TABLE PLAYERS (
    player_id INTEGER NOT NULL,
    team TEXT NOT NULL,
    homeland TEXT NOT NULL,
    market_value FLOAT NOT NULL,
    PRIMARY KEY (player_id)
);

CREATE TABLE GOALS (
    goal_id INTEGER NOT NULL,
    player_id INTEGER NOT NULL,
    timestamp DATETIME NOT NULL,
    beauty FLOAT NOT NULL,
    PRIMARY KEY (goal_id),
    FOREIGN KEY (player_id) REFERENCES PLAYERS(player_id)
);

-- insert data provided in task overview

INSERT INTO PLAYERS
VALUES (34546, "FCB", "argentina", 12.2);

INSERT INTO PLAYERS
VALUES (34547, "FCB", "spain", 8.6);

INSERT INTO PLAYERS
VALUES (34548, "PSG", "brazil", 9.8);

INSERT INTO PLAYERS
VALUES (34549, "FCB", "poland", 7.8);

INSERT INTO GOALS
VALUES (167, 34546, "2016-11-23 00:10:03", 0.89);

INSERT INTO GOALS
VALUES (158, 34548, "2016-11-23 02:56:32", 0.27);

INSERT INTO GOALS
VALUES (152, 34549, "2016-11-23 02:56:32", 0.27);

INSERT INTO GOALS
VALUES (180, 34549, "2016-11-23 02:56:32", 0.27);

INSERT INTO GOALS
VALUES (181, 34549, "2016-11-23 02:56:32", 0.27);

INSERT INTO GOALS
VALUES (182, 34549, "2016-11-23 02:56:32", 0.27);

INSERT INTO GOALS
VALUES (183, 34549, "2016-11-23 02:56:32", 0.27);

INSERT INTO GOALS
VALUES (184, 34549, "2016-11-23 02:56:32", 0.27);

INSERT INTO GOALS
VALUES (185, 34549, "2016-11-23 02:56:32", 0.27);

INSERT INTO GOALS
VALUES (186, 34549, "2016-11-23 02:56:32", 0.27);

INSERT INTO GOALS
VALUES (187, 34549, "2016-11-23 02:56:32", 0.27);

INSERT INTO GOALS
VALUES (188, 34549, "2016-11-23 02:56:32", 0.27);

INSERT INTO GOALS
VALUES (189, 34549, "2016-11-23 02:56:32", 0.27);

INSERT INTO GOALS
VALUES (190, 34549, "2016-11-23 02:56:32", 0.27);


-- fetch results

-- A1
SELECT *
FROM GOALS
WHERE beauty > 0.8 OR beauty < 0.1;

-- A2
SELECT DISTINCT p.*
FROM PLAYERS p
    INNER JOIN GOALS g ON g.player_id = p.player_id
WHERE p.team = "FCB";

-- A3
SELECT DISTINCT p.*
FROM PLAYERS p
    INNER JOIN GOALS g ON g.player_id = p.player_id
WHERE p.market_value < 8.0
GROUP BY p.player_id
HAVING COUNT(g.player_id) > 9;

-- TODO: A4

-- A5
SELECT AVG(g.beauty)
FROM GOALS g
INNER JOIN PLAYERS p
ON g.player_id = p.player_id
WHERE p.team = "PSG";

-- TODO: B

-- C

SELECT COUNT(*), p.team
FROM PLAYERS p
LEFT JOIN GOALS g
ON p.player_id = g.player_id
WHERE g.player_id IS NULL
GROUP BY p.team;
